<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Host - Apartamentos</title>

        <link rel="shortcut icon" href="assets/favicon.png" type="image/x-icon" />
        <link rel="stylesheet" href="css/style.css" />
        <link rel="stylesheet" href="css/output.css" />

        <script src="js/lib/axios.min.js"></script>
        <script src="js/lib/alpine.min.js" defer></script>
        <script src="js/lib/sweetalert.min.js" defer></script>
        <script src="js/lib/chart.min.js" defer></script>

        <script src="js/send.js"></script>
        <script src="js/util.js"></script>

        <!-- Redirect Script to login if the user isn't authenticated -->
        <script src="js/redirect.js"></script>
    </head>

    <body
        class="overflow-hidden bg-background"
        x-data="
            {
                mode: '',
                visible: false,
                roomData: {},
                reset() {
                    this.visible = false;
                    setTimeout(() => {
                        this.mode = '';
                        this.roomData = {};
                    }, 350);

                    document.getElementById('reload-btn').click();
                },

                showUserCard: false,

                user: {},
                userBg: '',
                contrasting: '',

                showManagerButtons: false,

                async getUser() {
                    this.user = await getUser();

                    this.userBg = stringToColor(this.user.email);
                    this.contrasting = getContrastingColor(this.userBg);

                    $refs.userIconBg.style.backgroundColor = this.userBg;
                    $refs.userIconBg.title = this.user.name;
                    $refs.userIconLabel.style.color = this.contrasting;

                    $refs.userIconCardBg.style.backgroundColor = this.userBg;
                    $refs.userIconCardLabel.style.color = this.contrasting;

                    $refs.userRole.innerText = formatUserRole(this.user.role);

                    this.showManagerButtons = getRoleLevel(this.user.role) >= getRoleLevel('manager');
                }
            }
        "
        x-init="
            await getUser();
        ">
        <!-- Header -->
        <header class="flex justify-center items-center h-16">
            <!-- Logo -->
            <a href="/"
                class="
                    w-12 h-12 p-2 ml-4 hover:brightness-110 focus:brightness-125
                    hover:bg-background-lighter rounded-md transition-[background, brightness] duration-300
                "
                title="Retornar à página inicial">
                <img src="assets/logo-h.svg" alt="H" class="w-full h-full" />
            </a>

            <!-- Hotel name -->
            <div class="flex-1 flex justify-center items-center">
                <h1
                    class="text-sm font-bold uppercase tracking-widest text-center"
                    :class="user.role === 'administrator'
                        ? 'p-2 px-4 cursor-pointer rounded-full hover:bg-background-lighter transition-[background] duration-300'
                        : ''
                    "
                    x-data="{ name: '' }"
                    x-init="name = await getHotelName();"
                    x-text="name"
                    
                    :title="user.role === 'administrator' ? 'Clique para alterar o nome do hotel' : ''"
                    @click.prevent="
                        if (user.role === 'administrator') {
                            swal({
                                title: 'Mudar o nome do hotel',
                                text: 'Digite o novo nome do hotel:',
                                content: {
                                    element: 'input',
                                    attributes: {
                                        placeholder: 'Novo nome do hotel',
                                        value: name,
                                    }
                                },
                                buttons: true
                            }).then(value => {
                                if (name || name === '') {
                                    setHotelName(value).then(async () => {
                                        name = await getHotelName();
                                    });
                                }
                            });
                        }
                    ">
                </h1>
            </div>


            <!-- Account info -->
            <div
                class="w-12 h-12 p-2 mr-4">
                <button title="Usuário" class="
                    w-full h-full rounded-full flex justify-center items-center
                    hover:brightness-110 transition-[background, brightness] duration-300
                "
                    @click.prevent="showUserCard = !showUserCard;"
                    x-ref="userIconBg">
                    <span x-ref="userIconLabel" x-text="user.name ? user.name[0] : ''"></span>
                </button>
            </div>
        </header>

        <!-- User Card -->
        <div class="
            absolute right-0 top-16 mr-2 p-4
            bg-background-more-lighter w-80 flex flex-col items-center rounded-2xl
        "
        x-show="showUserCard"
        x-transition.scale.origin.top
        @click.outside="showUserCard = false;">
            <div class="w-full h-20 mt-4 flex justify-center items-center">
                <div href :title="user.name"
                    class="w-20 h-20 aspect-auto rounded-full flex justify-center items-center"
                    x-ref="userIconCardBg">
                    <span class="font-bold text-2xl"
                        x-ref="userIconCardLabel"
                        x-text="user.name ? user.name[0] : ''">
                    </span>
                </div>
            </div>

            <h1 class="font-bold text-lg mt-3" x-text="user.name"></h1>
            <h2 class="font-normal text-sm" x-text="user.email"></h2>
            <h2 class="uppercase tracking-widest font-semibold text-xs m-2 bg-background-lightest brightness-125 p-1 px-2 rounded-full" x-ref="userRole"></h2>

            <div class="flex-1"></div>

            <button class="
                w-full h-10 rounded-full flex justify-center items-center bg-background-lightest mt-2
                hover:brightness-110 transition-[background, brightness] duration-300"
                @click.prevent="
                    localStorage.removeItem('token');
                    window.location.href = `http://${API_URL}/login`;
                ">
                <img class="w-5 mr-2" src="assets/icons/logout.png" alt="">
                <span>Sair</span>
            </button>
         </div>

        <main class="flex flex-col h-full-4 overflow-y-auto" x-data="{ rooms: [] }">
            <!-- Options Bar -->
            <div class="flex justify-center items-center h-16 sm:h-14 overflow-x-auto overflow-y-hidden bg-background-lighter m-4 rounded-full">
                <!-- Option Card - Guests -->
                <button class="
                    flex justify-center items-center
                    w-fit bg-background-lightest
                    m-2 my-4 p-4 py-2
                    font-semibold text-sm flex-nowrap text-nowrap
                    hover:brightness-110 rounded-full transition-[background, brightness] duration-300
                "
                @click.prevent="
                    mode = 'occupation';
                    visible = true;
                "
                >
                    <img class="mr-2 w-6 h-6" src="assets/icons/chart-pie.png" alt="Ocupação">
                    Ocupação
                </button>

                <!-- Option Card - Cash -->
                <button class="
                    flex justify-center items-center
                    w-fit bg-background-lightest
                    m-2 my-4 p-4 py-2
                    font-semibold text-sm flex-nowrap text-nowrap
                    hover:brightness-110 rounded-full transition-[background, brightness] duration-300
                "
                @click.prevent="
                    mode = 'cash';
                    visible = true;
                    cash = await getCash();
                ">
                    <img class="mr-2 w-5 h-5" src="assets/icons/dollar.png" alt="Caixa">
                    Caixa
                </button>

                <button class="
                    flex justify-center items-center
                    w-fit bg-background-lightest
                    m-2 my-4 p-4 py-2 pr-2 flex-nowrap
                    font-semibold text-sm
                    hover:brightness-110 rounded-full transition-[background, brightness] duration-300
                "
                x-show="showManagerButtons"
                @click.prevent="
                    mode = 'manage-users';
                    visible = true;
                "
                >
                    <img class="mr-2 w-6 h-6" src="assets/icons/user.png" alt="Ocupação">
                    
                    <span class="text-nowrap">Gerenciar Usuários</span>
                    <span class="ml-2 flex-nowrap text-nowrap uppercase tracking-widest font-semibold text-xs bg-background-lightest brightness-125 p-1 px-2 rounded-full">Gerente +</span>
                </button>
            </div>

            <!-- Hints -->
            <div class="w-full h-2 p-5 flex items-center text-sm font-medium">
                <div class="rounded-full bg-available w-1.5 h-1.5 mr-2.5"></div>
                <span class="mr-6">Vago</span>

                <div class="rounded-full bg-reserved w-1.5 h-1.5 mr-2.5"></div>
                <span class="mr-6">Reservado</span>

                <div class="rounded-full bg-occupied w-1.5 h-1.5 mr-2.5"></div>
                <span class="mr-6">Ocupado</span>

                <button class="
                        flex justify-center items-center w-8 h-8 p-2 hover:brightness-110
                        hover:bg-background-lighter rounded-full transition-[background, brightness] duration-300
                    "
                    id="reload-btn"
                    @click.prevent="rooms = await getRooms()"
                    title="Recarregar">
                    <img src="assets/icons/reload.png" alt="Recarregar">
                </button>
            </div>

            <!-- Room Area -->
            <div class="w-full flex-1 p-4 overflow-y-auto grid grid-rows-auto-fill grid-cols-auto-fill aspect-square"
                x-init="rooms = await getRooms()">
                <template x-for="room in rooms">
                    <div class="w-full h-full flex justify-center items-center">
                        <!-- Apartment Card -->
                        <button class="
                                flex justify-center items-center
                                w-20 h-20 hover:brightness-110
                                font-bold text-xl rounded-2xl
                                transition-[background, brightness] duration-300
                            "
                            :class="room.state === 'available'
                                ? 'bg-available'
                                : room.state === 'reserved'
                                    ? 'bg-reserved'
                                    : room.state === 'occupied'
                                        ? 'bg-occupied'
                                        : 'bg-red-100'
                            "
                            @click.prevent="
                                mode = room.state === 'available'
                                    ? 'room-available'
                                    : room.state === 'reserved'
                                        ? 'room-reserved'
                                        : room.state === 'occupied'
                                            ? 'room-occupied'
                                            : 'none';
                                visible = true;
                                roomData = room;
                            "
                            x-data="
                                {
                                    number: room.number,
                                    state: room.state
                                }
                            "
                            x-text="room.number">
                        </button>
                    </div>
                </template>
            </div>
        </main>

        <!-- Popup Card Background -->
        <div class="
            absolute top-0 left-0
            flex justify-center items-center
            w-full h-screen
            bg-black-25
        " x-show="visible" x-transition>
            <!-- Card -->
            <div class="
                w-4/5 md:w-4/5 h-9/10 flex flex-col
                bg-background-lighter rounded-2xl shadow-md top-full
            "
            x-data="
                {
                    hasUnsavedData: false,
                }
            "
            x-transition x-transition.duration.300ms>
                <!-- Header -->
                <div class="flex justify-center items-center w-full h-16 p-4">
                    <button x-show="['payment', 'visualize-payments'].includes(mode)" class="
                            flex justify-center items-center w-10 h-10 p-2 hover:brightness-110
                            hover:bg-background-lightest rounded-full transition-[background, brightness] duration-300
                        "
                        @click.prevent="
                            visible = false;
                            setTimeout(() => {
                                mode = 'room-occupied';
                                visible = true;
                            }, 350);
                        ">
                        <img class="w-5 h-5" src="assets/icons/back.png" alt="Back">
                    </button>

                    <div class="w-10" x-show="!['payment', 'visualize-payments'].includes(mode)"></div>

                    <span class="flex-1 text-center text-sm font-semibold uppercase tracking-widest" x-transition>
                        <p x-show="mode === 'cash'">Caixa</p>
                        <p x-show="mode === 'payment'" x-text="'Efetuar Pagamento: ' + roomData.number"></p>
                        <p x-show="mode === 'visualize-payments'" x-text="'Visualizar Pagamentos: ' + roomData.number"></p>
                        <p x-show="mode === 'occupation'">Ocupação</p>
                        
                        <p x-show="mode === 'manage-users'">
                            <span>Gerenciar Usuários</span>
                            <span class="ml-2 uppercase tracking-widest font-semibold text-xs bg-background-lightest brightness-125 p-1 px-2 rounded-full">Gerente +</span>
                        </p>

                        <p x-show="mode === 'room-available'" x-text="'Reservar: ' + roomData.number"></p>
                        <p x-show="mode === 'room-reserved'" x-text="'Editar Reserva: ' + roomData.number"></p>
                        <p x-show="mode === 'room-occupied'" x-text="'Visualizar Apartamento: ' + roomData.number"></p>
                    </span>

                    <button class="
                            flex justify-center items-center w-10 h-10 p-2 ml-4 hover:brightness-110
                            hover:bg-background-lightest rounded-full transition-[background, brightness] duration-300
                        "
                        @click.prevent="
                            if (['room-available', 'room-reserved', 'room-occupied', 'manage-users'].includes(mode) && hasUnsavedData) {
                                swal({
                                    title: 'Você tem certeza disso?',
                                    text: 'Você deseja fechar a tela e perder as alterações?',
                                    icon: 'warning',
                                    buttons: true,
                                    dangerMode: 'true',
                                })
                                    .then(async (accepted) => {
                                        if (accepted) {
                                            hasUnsavedData = false;
                                            reset();
                                        }
                                    });
                            }

                            else
                                reset();
                        ">
                        <img class="w-6 h-6" src="assets/icons/close.png" alt="X">
                    </button>
                </div>

                <template x-if="mode === 'cash'">
                    <div class="w-full h-full p-5 pt-0 flex-1 flex flex-col basis-0"
                        x-data="{
                            cash: 0,
                            openingTime: 0,
                            payments: [],
                            ascending: false,
                        }"
                        x-init="
                            cash = await getCash();
                            openingTime = await getCashOpeningTime();
                            payments = await getPayments();
                            payments.reverse();
                        ">
                        <div class="flex flex-col md:flex-row">
                            <div class="w-full md:w-1/2">
                                <div class="w-fit">
                                    <label class="
                                        relative top-5 left-2 bg-background-lighter p-1 px-2 rounded-t-xl
                                        text-md text-label z-10
                                    ">Total do caixa</label>
                                    <p class="font-bold text-3xl mt-2 w-fit p-4 px-6 rounded-full border-2 border-background-lightest"
                                    x-text="formatCurrency(cash * 100)"></p>
                                </div>
                            </div>
                
                            <div class="w-full md:w-1/2 mt-4 md:mt-0 flex md:justify-end">
                                <div class="w-fit">
                                    <label class="
                                        relative top-5 left-2 bg-background-lighter p-1 px-2 rounded-t-xl
                                        text-md text-label z-10
                                    ">Data de abertura</label>
                                    <p class="font-bold text-3xl mt-2 w-fit p-4 px-6 rounded-full border-2 border-background-lightest"
                                    x-text="unixToDateTime(openingTime)"></p>
                                </div>
                            </div>
                        </div>
                
                        <div class="w-full flex ml-4">
                            <button class="
                                    flex justify-center items-center w-8 h-8 p-2 mt-2 hover:brightness-110
                                    hover:bg-background-lightest rounded-full
                                    transition-[background, brightness] duration-300
                                    "
                                id="reload-cash"
                                @click.prevent="
                                    cash = await getCash();
                                    openingTime = await getCashOpeningTime();
                                    payments = await getPayments();
                                    payments.reverse();
                                "
                                title="Recarregar Caixa">
                                <img src="assets/icons/reload.png" alt="Recarregar">
                            </button>
                
                            <!-- Close Cash confirmation -->
                            <button class="
                                    flex justify-center items-center w-8 h-8 p-2 mt-2 ml-2
                                    hover:brightness-110 hover:bg-background-lightest rounded-full
                                    transition-[background, brightness] duration-300"
                                @click.prevent="
                                    swal({
                                        title: 'Você tem certeza disso?',
                                        text: payments.length === 0
                                                ? ' Ainda não foram registrados pagamentos. Deseja fechar o caixa assim mesmo?'
                                                : 'Você deseja fechar o caixa e limpar a lista de pagamentos?',
                                        icon: 'warning',
                                        buttons: true,
                                        dangerMode: 'true',
                                    })
                                    .then(async (accepted) => {
                                        if (accepted) {
                                            await closeCash();

                                            cash = await getCash();
                                            openingTime = await getCashOpeningTime();
                                            payments = await getPayments();

                                            payments.reverse();
                                        }
                                    })
                                "
                                title="Fechar Caixa">
                                <img src="assets/icons/dollar.png" alt="Recarregar">
                            </button>
                        </div>
                
                        <div class="flex-1 flex flex-col mt-4">
                            <div class="w-full h-10 flex items-center">
                                <label class="
                                    relative top-3 left-4 bg-background-more-lighter
                                    p-1 px-2 rounded-xl text-md text-label
                                ">
                                    Pagamentos
                                </label>
                                <div class="flex-1"></div>

                                <button x-show="payments.length > 1" class="
                                        flex justify-center items-center w-8 h-8 p-2 mb-2 hover:brightness-110
                                        hover:bg-background-lightest rounded-full
                                        transition-[background, brightness] duration-300
                                    "
                                    @click.prevent="
                                        payments.reverse();
                                        ascending = !ascending;
                                    "
                                    :title="ascending ? 'Ordenar por: mais recentes primeiro' : 'Ordenar por: mais antigas primeiro'">
                                    <img :src="ascending ? 'assets/icons/order-up.png' : 'assets/icons/order-down.png'" alt="Ordenar">
                                </button>
                
                                <button class="
                                        flex justify-center items-center w-8 h-8 p-2 mb-2 hover:brightness-110
                                        hover:bg-background-lightest rounded-full
                                        transition-[background, brightness] duration-300
                                    "
                                    @click.prevent="
                                        cash = await getCash();
                                        openingTime = await getCashOpeningTime();
                                        payments = await getPayments();
                                        payments.reverse();
                                    "
                                    title="Recarregar Pagamentos">
                                    <img src="assets/icons/reload.png" alt="Recarregar">
                                </button>
                            </div>
                            <div class="
                                flex-1 basis-0 h-full max-h-full overflow-y-auto
                                bg-background-more-lighter rounded-xl p-4
                            ">
                            <div x-show="payments.length > 0">
                                <template x-for="payment in payments">
                                    <div
                                        class="
                                            bg-background-bit-more-lighter rounded-full
                                            w-full h-16 mb-4 flex items-center p-4 px-6
                                        ">
                                        <h1 class="font-bold text-xl flex-1" x-text="formatCurrency(payment.amount * 100)"></h1>
                
                                        <div class="w-1/2 flex justify-end">
                                            <p class="ml-2 mr-2" x-text="formatPaymentMethod(payment.method)"></p> &bull;
                                            <p class="ml-2 mr-2" x-text="payment.room"></p> &bull;
                                            <p class="ml-2 mr-2" x-text="unixToDateTime(payment.time)"></p>
                                        </div>
                                    </div>
                                </template>
                            </div>

                            <div class="w-full h-full flex flex-col justify-center items-center" x-show="payments.length === 0">
                                <img class="mb-4" src="assets/icons/no-money.png" alt="Sem pagamentos">

                                <h1 class="font-bold text-2xl">Sem pagamentos</h1>
                                <p>Não foram encontrados pagamentos.</p>
                            </div>
                        </div>
                    </div>
                </template>                

                <template x-if="mode === 'payment'">
                    <div class="w-full h-full max-h-full p-5 pt-0 flex flex-col flex-1 basis-0"
                    x-data="{
                        amount: '0',
                        selectedMethod: 'cash',
                        debt: 0,
                    }"
                    x-init="
                        debt = await getRoomDebt(roomData.number);
                    ">
                        <div class="flex flex-col md:flex-row flex-1 basis-0 w-full">
                            <!-- Left -->
                            <div class="md:w-1/2 w-full md:h-full h-1/2 pr-4 pb-4 md:pb-0 overflow-auto">
                                <div x-data="
                                    {
                                        focused: false,
                                    }
                                ">
                                    <label class="
                                        relative top-4 left-3 bg-background-more-lighter p-1 px-2 rounded-t-xl
                                        text-md transition-[color] duration-300
                                    "
                                    :class="focused ? 'text-reserved' : 'text-label'">
                                        Valor
                                    </label>
                                    <input class="
                                        font-bold text-2xl mt-2 w-full p-2 px-4 transition-[border] duration-300
                                        outline-none bg-background-more-lighter rounded-full border-2
                                    "
                                    :class="focused ? 'border-reserved' : 'border-background-more-lighter'"
                                    type="text" x-model="amount"

                                    @input="(e) => {
                                        formatMoney(e);
                                        amount = e.target.value;
                                    }"

                                    @focus="focused = true"
                                    @blur="focused = false"

                                    x-init="
                                        const roomDebt = await getRoomDebt(roomData.number) * 100;
                                        amount = formatCurrency(roomDebt > 0 ? roomDebt : 0);
                                    "
                                    :disabled="mode === 'room-occupied'">
                                </div>

                                <div class="flex w-full">
                                    <div class="w-1/2 mr-4">
                                        <label class="
                                            relative top-5 left-2 bg-background-lighter p-1 px-2 rounded-t-xl
                                            text-md text-label z-10
                                        ">
                                            Conta atual
                                        </label>
                                        <p class="font-bold text-2xl mt-2 w-full p-4 rounded-full border-2 border-background-lightest"
                                        x-text="formatCurrency(debt * 100)"></p>
                                    </div>

                                    <div class="w-1/2 ml-4">
                                        <label class="
                                            relative top-5 left-2 bg-background-lighter p-1 px-2 rounded-t-xl
                                            text-md text-label z-10
                                        ">
                                            Restante
                                        </label>
                                        <p class="font-bold text-2xl mt-2 w-full p-4 rounded-full border-2 border-background-lightest"
                                        x-text="formatCurrency((debt - currencyToFloat(amount)) * 100)"></p>
                                    </div>
                                </div>
                            </div>
                            <!-- Right -->
                            <div class="flex-1 basis-0 max-h-full h-full md:pl-4 pb-4 flex flex-col">
                                <div>
                                    <label class="
                                        relative top-4 left-3 bg-background-more-lighter p-1 px-2 rounded-t-xl
                                        text-md transition-[color] duration-300 text-label
                                    ">
                                        Forma de pagamento
                                    </label>
                                </div>

                                <div class="
                                    flex-1 grid grid-cols-2 grid-rows-2 basis-0 h-full bg-background-more-lighter
                                    rounded-xl mt-2 p-4 overflow-y-auto
                                ">
                                    <template x-for="method in [
                                        {
                                            'method': 'cash',
                                            'name': 'Dinheiro',
                                            'icon': 'dollar-50.png'
                                        },
                                        {
                                            'method': 'card',
                                            'name': 'Cartão',
                                            'icon': 'card.png'
                                        },
                                        {
                                            'method': 'pix',
                                            'name': 'Pix',
                                            'icon': 'pix.png'
                                        },
                                        {
                                            'method': 'billed',
                                            'name': 'Faturado',
                                            'icon': 'billed.png'
                                        }
                                    ]
                                    ">
                                        <div class="
                                            w-11/12 h-11/12 bg-background-bit-more-lighter
                                            m-2 rounded-2xl flex flex-col cursor-pointer
                                            transition-[background, brightness] duration-300
                                        "
                                        :class="
                                            selectedMethod === method.method
                                                ? 'brightness-125 hover:brightness-150'
                                                : 'brightness-100 hover:brightness-110'
                                            "
                                        @click.prevent="selectedMethod = method.method">
                                            <div class="flex-1 flex justify-center items-center">
                                                <img :src="'assets/icons/' + method.icon" alt="Icon">
                                            </div>
                                            <p class="w-full h-12 text-center"
                                                x-text="method.name">
                                            </p>
                                        </div>
                                    </template>
                                </div>
                            </div>
                        </div>
                        <!-- Footer -->
                        <div class="
                            w-full h-14 flex items-center justify-evenly
                            rounded-full bg-background-more-lighter
                        ">
                            <!-- Botão Pagar -->
                            <button class="
                                w-fit h-10 flex items-center justify-center p-2 pr-4 pl-4
                                rounded-full bg-background-lightest
                                hover:brightness-110 transition-[background, brightness] duration-300
                            "
                            @click.prevent="
                                const res = await pay(roomData.number, amount, selectedMethod);

                                if (res.success) {
                                    visible = false;
                                    setTimeout(() => {
                                        mode = 'room-occupied';
                                        visible = true;
                                    }, 350);
                
                                    const name = 'reload-btn'; // this is because VS Code's coloring complains
                                    document.getElementById(name).click();
                                }
                            ">
                                Efetuar Pagamento
                            </button>
                        </div>
                    </div>
                </template>

                <template x-if="mode === 'visualize-payments'">
                    <div class="w-full h-full max-h-full p-5 pt-0 flex flex-col flex-1 basis-0"
                        x-data="{ ascending: false }"
                        x-init="
                            roomData.payments = (await getRoom(roomData.number)).payments;
                            roomData.payments.reverse();
                        ">
                        <div class="w-full h-14 flex items-center">
                            <label class="relative top-4 left-4 bg-background-more-lighter p-1 px-2 rounded-t-xl text-md text-label">Pagamentos</label>
                            <div class="flex-1"></div>
            
                            <button x-show="roomData.payments.length > 1" class="
                                    flex justify-center items-center w-8 h-8 p-2 mt-2 hover:brightness-110
                                    hover:bg-background-lightest rounded-full
                                    transition-[background, brightness] duration-300
                                "
                                @click.prevent="
                                    roomData.payments.reverse();
                                    ascending = !ascending;
                                "
                                :title="ascending ? 'Ordenar por: mais recentes primeiro' : 'Ordenar por: mais antigas primeiro'">
                                <img :src="ascending ? 'assets/icons/order-up.png' : 'assets/icons/order-down.png'" alt="Ordenar">
                            </button>
            
                            <button class="
                                    flex justify-center items-center w-8 h-8 p-2 mt-2 hover:brightness-110
                                    hover:bg-background-lightest rounded-full
                                    transition-[background, brightness] duration-300
                                "
                                @click.prevent="
                                    roomData.payments = (await getRoom(roomData.number)).payments;
                                    roomData.payments.reverse();
                                "
                                title="Recarregar Pagamentos">
                                <img src="assets/icons/reload.png" alt="Recarregar">
                            </button>
                        </div>
                        <div class="
                            flex-1 basis-0 h-full max-h-full overflow-y-auto
                            bg-background-more-lighter rounded-lg p-4
                        ">
                            <div x-show="roomData.payments.length > 0">
                                <template x-for="payment in roomData.payments">
                                    <div
                                        class="
                                            bg-background-bit-more-lighter rounded-full
                                            w-full h-16 mb-4 flex items-center p-4 px-6
                                        ">
                                        <h1 class="font-bold text-xl flex-1" x-text="formatCurrency(payment.amount * 100)"></h1>
                
                                        <div class="w-1/2 flex justify-end">
                                            <p class="ml-2 mr-2" x-text="formatPaymentMethod(payment.method)"></p> &bull;
                                            <p class="ml-2 mr-2" x-text="payment.room"></p> &bull;
                                            <p class="ml-2 mr-2" x-text="unixToDateTime(payment.time)"></p>
                                        </div>
                                    </div>
                                </template>
                            </div>

                            <div class="w-full h-full flex flex-col justify-center items-center" x-show="roomData.payments.length === 0">
                                <img class="mb-4" src="assets/icons/no-money.png" alt="Sem pagamentos">

                                <h1 class="font-bold text-2xl">Sem pagamentos</h1>
                                <p>Não foram encontrados pagamentos para este quarto, durante esta estadia.</p>
                            </div>
                        </div>
                    </div>
                </template>

                <template x-if="mode === 'occupation'">
                    <div class="p-6 flex-1 basis-0 flex flex-col" x-data="{ rooms: [] }"
                         x-init="
                            (async () => {
                                rooms = await getRooms();
                                const ctx = $el.querySelector('canvas');
                                new Chart(ctx, {
                                    type: 'pie',
                                    data: {
                                        labels: ['Vago', 'Reservado', 'Ocupado'],
                                        datasets: [{
                                            label: 'Quantidade de quartos',
                                            data: [
                                                rooms.filter(r => r.state === 'available').length,
                                                rooms.filter(r => r.state === 'reserved').length,
                                                rooms.filter(r => r.state === 'occupied').length,
                                            ],
                                            backgroundColor: [
                                                '#6dc644',
                                                '#3976d0',
                                                '#c64444',
                                            ],
                                            hoverOffset: 4,
                                        }],
                                    },
                                    options: {
                                        responsive: true,
                                        maintainAspectRatio: false,
                                    }
                                });
                            })()
                        ">
                        <div class="w-full h-fit flex lg:flex-row flex-col">
                            <!-- Left -->
                            <div class="w-full lg:w-1/2 h-full flex justify-center lg:justify-start items-center">
                                <div class="lg:w-64 w-2/3 relative bottom-5">
                                    <label class="
                                        relative top-5 left-2 bg-background-lighter p-1 px-2 rounded-t-xl
                                        text-md text-label z-10
                                    ">Quantidade de quartos</label>

                                    <p class="font-bold text-2xl mt-2 w-full p-4 rounded-full border-2 border-background-lightest"
                                    x-text="rooms.length"></p>
                                </div>
                            </div>

                            <!-- Right -->
                            <div class="flex-1 basis-0 flex justify-center lg:justify-end items-center">
                                <div class="w-40 mr-4 relative bottom-5">
                                    <label class="
                                        relative top-5 left-2 bg-background-lighter p-1 px-2 rounded-t-xl
                                        text-md text-label z-10
                                    ">Vagos</label>

                                    <p class="font-bold text-lg mt-2 w-full p-4 rounded-full border-2 border-background-lightest"
                                    x-text="rooms.filter(r => r.state === 'available').length + ` (${
                                        Math.round(
                                            (rooms.filter(r => r.state === 'available').length / rooms.length)
                                            * 100
                                        )
                                    }%)`"></p>
                                </div>

                                <div class="w-40 mr-4 relative bottom-5">
                                    <label class="
                                        relative top-5 left-2 bg-background-lighter p-1 px-2 rounded-t-xl
                                        text-md text-label z-10
                                    ">Reservados</label>

                                    <p class="font-bold text-lg mt-2 w-full p-4 rounded-full border-2 border-background-lightest"
                                    x-text="rooms.filter(r => r.state === 'reserved').length + ` (${
                                        Math.round(
                                            (rooms.filter(r => r.state === 'reserved').length / rooms.length)
                                            * 100
                                        )
                                    }%)`"></p>
                                </div>

                                <div class="w-40 mr-4 relative bottom-5">
                                    <label class="
                                        relative top-5 left-2 bg-background-lighter p-1 px-2 rounded-t-xl
                                        text-md text-label z-10
                                    ">Ocupados</label>

                                    <p class="font-bold text-lg mt-2 w-full p-4 rounded-full border-2 border-background-lightest"
                                    x-text="rooms.filter(r => r.state === 'occupied').length + ` (${
                                        Math.round(
                                            (rooms.filter(r => r.state === 'occupied').length / rooms.length)
                                            * 100
                                        )
                                    }%)`"></p>
                                </div>
                            </div>
                        </div>

                        <div class="flex-1 basis-0 overflow-y-hidden bg-background-more-lighter p-4 rounded-lg">
                            <canvas class="flex-1 basis-0"></canvas>
                        </div>
                    </div>
                </template>

                <template x-if="mode === 'manage-users'">
                    <div class="flex-1 basis-0 overflow-x-hidden overflow-y-auto flex flex-col p-4"
                        :class="hasUnsavedData ? '' : ' pb-0'"
                        x-data="
                            {
                                users: [],
                                fetchedUsers: [],
                            }
                        "
                        x-init="
                            users = await getUsers();
                            fetchedUsers = await getUsers();

                            hasUnsavedData = false;
                        ">
                        <div class="flex-1 basis-0 overflow-auto flex flex-col justify-start items-center"
                            :class="hasUnsavedData ? 'mb-4' : ''">
                            <template x-for="(iuser, index) in users">
                                <!-- User Card -->
                                <div class="w-2/3 flex flex-col justify-start items-center bg-background-more-lighter p-4 rounded-2xl mb-4"
                                    x-data="
                                        {
                                            canChange: getRoleLevel(iuser.role) < getRoleLevel(user.role),
                                        }
                                    ">
                                    <div class="w-full flex justify-start items-center">
                                        <span class="font-bold uppercase tracking-widest text-sm ml-2 w-fit" x-text="'Usuário #' + (index + 1)"></span>
                                        <span class="flex justify-start items-center">
                                            <span class="flex justify-start items-center ml-4 bg-background-lightest p-2 px-4 rounded-full" x-show="!canChange">
                                                <img class="w-5 mr-2" src="/assets/icons/lock.png" alt="Lock">
                                                <span class="text-occupied text-sm">Esse usuário possui um cargo igual ou superior ao seu.</span>
                                            </span>
                                        </span>
                                        
                                        <div class="flex-1"></div>

                                        <button class="
                                            flex justify-center items-center w-8 h-8 p-2 ml-4
                                            hover:brightness-110 hover:bg-background-lightest rounded-full
                                            transition-[background, brightness] duration-300
                                        "
                                        x-show="
                                            users.length > 1 &&
                                            canChange &&
                                            (fetchedUsers[index] || iuser).email !== user.email
                                        "
                                        @click.prevent="
                                            users.splice(index, 1);
                                            hasUnsavedData = true;
                                        "
                                        title="Remover usuário">
                                            <img src="assets/icons/close.png" alt="X" >
                                        </button>
                                    </div>
                                    <div class="w-full">
                                        <div x-data="
                                            {
                                                focused: false,
                                            }
                                        " x-show="canChange">
                                            <label class="
                                                relative top-4 left-3 bg-background-lightest p-1 px-2 rounded-t-xl
                                                text-md transition-[color] duration-300
                                            "
                                            :class="focused ? 'text-reserved' : 'text-label'">
                                                Nome
                                            </label>
                                            <input class="
                                                font-bold text-xl mt-2 w-full p-2 px-4 transition-[border] duration-300
                                                outline-none border-2 bg-background-lightest rounded-full
                                            "
                                            :class="focused ? 'border-reserved' : 'border-background-lightest'"
                                            type="text"
                                            x-model="iuser.name"
                                            @input="hasUnsavedData = true"
                                            @focus="focused = true"
                                            @blur="focused = false">
                                        </div>

                                        <div x-show="!canChange">
                                            <label class="
                                                relative top-5 left-2 bg-background-more-lighter p-1 px-2 rounded-t-xl
                                                text-md text-label z-10
                                            ">Nome</label>
                                            <p class="font-bold text-xl mt-2 w-full p-4 rounded-full border-2 border-background-lightest"
                                            x-text="iuser.name"></p>
                                        </div>

                                        <div x-data="
                                            {
                                                focused: false,
                                            }
                                        " x-show="canChange">
                                            <label class="
                                                relative top-4 left-3 bg-background-lightest p-1 px-2 rounded-t-xl
                                                text-md transition-[color] duration-300 w-fit flex justify-start items-center
                                            " >
                                                <span :class="focused ? 'text-reserved' : 'text-label'">E-mail</span>
                                            </label>
                                            <input class="
                                                font-bold text-xl mt-2 w-full p-2 px-4 transition-[border] duration-300
                                                outline-none border-2 bg-background-lightest rounded-full
                                            "
                                            :class="focused ? 'border-reserved' : 'border-background-lightest'"
                                            type="text"
                                            x-model="iuser.email"
                            
                                            @input="hasUnsavedData = true"
                                            @focus="focused = true"
                                            @blur="focused = false">
                                        </div>

                                        <div x-show="!canChange">
                                            <label class="
                                                relative top-5 left-2 bg-background-more-lighter p-1 px-2 rounded-t-xl
                                                text-md text-label z-10
                                            ">E-mail</label>
                                            <p class="font-bold text-xl mt-2 w-full p-4 rounded-full border-2 border-background-lightest"
                                            x-text="iuser.email"></p>
                                        </div>

                                        <div x-data="
                                            {
                                                focused: false,
                                            }
                                        " x-show="canChange">
                                            <label class="
                                                relative top-4 left-3 bg-background-lightest p-1 px-2 rounded-t-xl
                                                text-md transition-[color] duration-300
                                            "
                                            :class="focused ? 'text-reserved' : 'text-label'">
                                                Redefinir senha
                                            </label>
                                            <label class="
                                                relative top-11 -left-[8.4rem] bg-background-lightest p-1 px-2 rounded-t-xl
                                                text-md transition-[opacity] duration-300 text-placeholder pointer-events-none
                                            "
                                            :class="(focused || iuser.password !== '' ? 'opacity-0' : 'opacity-100') + (canChange ? ' cursor-text' : '')"
                                            @click="$refs.password.focus()">
                                                Deixe em branco para manter a senha atual
                                            </label>
                                            <input class="
                                                font-bold text-xl mt-2 w-full p-2 px-4 transition-[border] duration-300
                                                outline-none border-2 bg-background-lightest rounded-full
                                            "
                                            :class="focused ? 'border-reserved' : 'border-background-lightest'"
                                            type="password"
                                            x-model="iuser.password"
                                            x-ref="password"
                            
                                            @input="hasUnsavedData = true"
                                            @focus="focused = true"
                                            @blur="focused = false">
                                        </div>
                                        <div class="w-full">
                                            <label class="
                                                relative top-6 left-3 bg-background-more-lighter p-1 px-2 rounded-t-xl
                                                text-md text-label z-10 w-fit flex justify-start items-center
                                            ">
                                                <span class="text-md text-label">Cargo</span>
                                            </label>
                                            <div>
                                                <div class="mt-2 w-full p-4 rounded-full border-2 border-background-lightest flex justify-center">
                                                    <template x-for="
                                                        role in [
                                                            {
                                                                name: 'Recepcionista',
                                                                roleId: 'receptionist',
                                                                color: 'bg-available',
                                                            },
                                                            {
                                                                name: 'Gerente',
                                                                roleId: 'manager',
                                                                color: 'bg-reserved',
                                                            },
                                                            {
                                                                name: 'Administrador',
                                                                roleId: 'administrator',
                                                                color: 'bg-occupied',
                                                            },
                                                        ]
                                                    ">
                                                        <button class="
                                                                font-bold text-lg bg-background-lightest p-2 px-4 rounded-full
                                                                mr-4 transition-[background, brightness] duration-300
                                                                flex justify-center items-center
                                                            "
                                                            :class="
                                                                canChange
                                                                    ? getRoleLevel(role.roleId) >= getRoleLevel(user.role)
                                                                        ? 'brightness-90 cursor-default'
                                                                        : iuser.role === role.roleId
                                                                            ? 'brightness-125 hover:brightness-150'
                                                                            : 'hover:brightness-110'
                                                                    : iuser.role === role.roleId
                                                                        ? 'brightness-90 cursor-default'
                                                                        : 'brightness-75 cursor-default'
                                                            "
                                                            @click.prevent="
                                                                if (canChange && getRoleLevel(role.roleId) < getRoleLevel(user.role) && iuser.role !== role.roleId) {
                                                                    iuser.role = role.roleId;
                                                                    hasUnsavedData = true;
                                                                }
                                                            ">
                                                            <div class="rounded-full w-1.5 h-1.5 mr-2.5" :class="role.color"></div>
                                                            <span x-text="role.name"></span>
                                                        </button>
                                                    </template>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </template>
                            
                            <button
                                class="
                                    w-1/2 p-4 bg-background-more-lighter rounded-full mb-4
                                    flex justify-center items-center hover:brightness-110
                                    transition-[background, brightness] duration-300
                                "
                                @click.prevent="
                                    users.push({
                                        id: users.length,
                                        name: '',
                                        email: '',
                                        role: 'receptionist',
                                        password: '',
                                    });

                                    hasUnsavedData = true;
                                ">
                                <img class="w-5 mr-4" src="/assets/icons/plus.png" alt="">
                                Adicionar usuário
                            </button>
                        </div>

                        <div x-show="hasUnsavedData" class="
                            w-full h-12 mb-4 p-2 mr-4 flex justify-center
                            items-center rounded-full border-occupied border-2
                        "
                        x-transition>
                        <!-- TODO: don't change the flag if the input wasn't accepted -->
                            <img class="mr-3 w-7" src="assets/icons/warning.png" alt="Warning">
                            Você possui alterações não salvas.
                        </div>

                        <!-- Footer -->
                        <div class="
                            w-full h-14 flex items-center justify-evenly
                            rounded-full bg-background-more-lighter
                        "
                        x-show="hasUnsavedData" x-transition>
                            <button x-show="hasUnsavedData" class="
                                w-fit h-10 flex items-center justify-center p-2 pr-4 pl-4
                                rounded-full bg-background-lightest
                                hover:brightness-110 transition-[background, brightness] duration-300
                            "
                            @click.prevent="
                                const res = await editUsers(users);
                                    
                                if (res.success)
                                    hasUnsavedData = false;

                                users.forEach(u => u.password = '');
                                users.forEach(u => u.email = u.email.toLowerCase());
                            "
                            x-transition>
                                Salvar Alterações
                            </button>
                        </div>
                    </div>
                </template>

                <template x-if="['room-available', 'room-reserved', 'room-occupied'].includes(mode)">
                    <div class="w-full h-full max-h-full p-5 pt-0 flex flex-col flex-1 basis-0"
                    x-data="
                        {
                            price: '0',
                            debt: 0,
                            check_out: mode === 'room-available'
                                ? ''
                                : unixToDate(roomData.check_out),

                            guests: mode === 'room-available'
                                ? [ { name: '', cpf: '0', phone: '0' } ]
                                : roomData.guests,
                            
                            changedCheckOut: false,
                        }"
                    x-init="
                        if (mode === 'room-available') {
                            const tomorrow = new Date();
                            tomorrow.setDate(tomorrow.getDate() + 1);

                            check_out = tomorrow.toISOString().split('T')[0];
                        }
                    ">

                        <div class="flex flex-col md:flex-row flex-1 basis-0 w-full">
                            <!-- Left -->
                            <div class="md:w-1/2 w-full md:h-full h-1/2 pr-4 pb-4 md:pb-0 overflow-auto">
                                <!-- Entry -->
                                <div x-data="
                                    {
                                        focused: false,
                                    }
                                "
                                x-show="mode !== 'room-occupied' || getRoleLevel(user.role) >= getRoleLevel('manager')">
                                    <label class="
                                        relative top-4 left-2 bg-background-more-lighter p-1 px-2 rounded-t-xl
                                        text-md transition-[color] duration-300
                                    "
                                    :class="focused ? 'text-reserved' : 'text-label'">
                                        Valor da diária
                                    </label>
                                    
                                    <input class="
                                        font-bold text-2xl mt-2 w-full p-2 px-4
                                        outline-none bg-background-more-lighter rounded-full
                                        transition-[border] duration-300 border-2
                                    "
                                    :class="focused ? 'border-reserved' : 'border-background-more-lighter'"

                                    type="text" x-model="price"
                                    x-init="
                                        price = mode === 'room-available'
                                            ? formatCurrency(price)
                                            : formatCurrency(roomData.price * 100)
                                    "
                                    @input="(e) => {
                                        formatMoney(e);
                                        price = e.target.value;
                                    
                                        hasUnsavedData = true;
                                    }"

                                    @focus="focused = true"
                                    @blur="focused = false">
                                </div>

                                <div x-show="mode === 'room-occupied' && getRoleLevel(user.role) === getRoleLevel('receptionist')"
                                    x-init="
                                        if (mode === 'room-occupied')
                                            debt = await getRoomDebt(roomData.number) * 100;
                                    ">
                                    <label class="
                                        relative top-5 left-2 bg-background-lighter p-1 px-2 rounded-t-xl
                                        text-md text-label z-10
                                    ">Valor da diária</label>
                                    <p class="font-bold text-2xl mt-2 w-full p-4 rounded-full border-2 border-background-lightest"
                                    x-text="price"></p>
                                </div>

                                <!-- Entry -->
                                <div x-data="
                                    {
                                        focused: false,
                                    }
                                ">
                                    <label class="
                                        relative top-4 left-2 bg-background-more-lighter p-1 px-2
                                        rounded-t-xl text-md text-label z-10 transition-[color] duration-300"
                                        :class="focused ? 'text-reserved' : 'text-label'">
                                        Data do check-out
                                    </label>
                                    <input type="date" id="date" class="
                                        font-bold text-2xl mt-2 w-full p-2 px-4 transition-[border] duration-300
                                        outline-none bg-background-more-lighter rounded-full border-2
                                    "
                                    :class="focused ? 'border-reserved' : 'border-background-more-lighter'"
                                    x-model="check_out"
                                    x-init="
                                        const tomorrow = new Date();
                                        tomorrow.setDate(tomorrow.getDate() + 1);

                                        const element = document.getElementById('date');
                                        const parsed = tomorrow.toISOString().split('T')[0];
                                        element.setAttribute('min', parsed);
                                    "
                                    @input="
                                        if (['room-reserved', 'room-occupied'].includes(mode)) {
                                            hasUnsavedData = true;
                                            changedCheckOut = true;
                                        }
                                    "
                                    @focus="focused = true"
                                    @blur="focused = false">
                                </div>

                                <div x-show="mode === 'room-occupied'"
                                    x-init="
                                        if (mode === 'room-occupied')
                                            debt = await getRoomDebt(roomData.number) * 100;
                                    ">
                                    <label class="
                                        relative top-5 left-2 bg-background-lighter p-1 px-2 rounded-t-xl
                                        text-md text-label z-10
                                    ">Hora do check-in</label>
                                    <p class="font-bold text-2xl mt-2 w-full p-4 rounded-full border-2 border-background-lightest"
                                    x-text="unixToDateTime(roomData.check_in)"></p>
                                </div>

                                <div class="w-full flex">
                                    <!-- Info -->
                                    <div class="w-1/2 mr-3">
                                        <label class="
                                            relative top-5 left-2 bg-background-lighter p-1 px-2 rounded-t-xl
                                            text-md text-label z-10
                                        ">
                                            Hora do check-out
                                        </label>
                                        <p class="font-bold text-2xl mt-2 w-full p-4 rounded-full border-2 border-background-lightest"
                                        x-text="(await getCheckOutHour()).formatted"></p>
                                    </div>

                                    <div class="w-1/2 ml-3" x-show="mode === 'room-occupied'"
                                        x-init="
                                            if (mode === 'room-occupied')
                                                debt = await getRoomDebt(roomData.number) * 100;
                                        ">
                                        <label class="
                                            relative top-5 left-2 bg-background-lighter p-1 px-2 rounded-t-xl
                                            text-md text-label z-10
                                        ">Conta</label>
                                        <p class="font-bold text-2xl mt-2 w-full p-4 rounded-full border-2 border-background-lightest"
                                        x-text="formatCurrency(debt)"></p>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Right -->
                            <div class="flex-1 basis-0 max-h-full h-full md:pl-4 pb-4 flex flex-col">
                                <div class="flex items-center">
                                    <label class="
                                        relative top-4 left-3 bg-background-more-lighter p-1 px-2 rounded-xl
                                        text-md transition-[color] duration-300 text-label z-10
                                    ">
                                        Hóspedes
                                    </label>
                                </div>

                                <div class="
                                    flex-1 basis-0 h-full bg-background-more-lighter
                                    rounded-xl mt-2 p-4 overflow-y-auto flex flex-col justify-start items-center
                                ">
                                    <template x-for="(guest, index) in guests">
                                        <div class="w-full h-fit bg-background-bit-more-lighter rounded-xl p-4 mb-4"
                                            x-data="{
                                                element_index: index
                                            }">
                                            <div class="flex items-center">
                                                <h1 class="
                                                    text-sm font-semibold uppercase tracking-widest mb-4
                                                    flex-1 flex items-center
                                                "
                                                x-text="'Hóspede #' + (index + 1)">
                                                </h1>

                                                <button class="
                                                    flex justify-center items-center w-8 h-8 p-2 ml-4
                                                    hover:brightness-110 hover:bg-background-lightest rounded-full
                                                    transition-[background, brightness] duration-300
                                                "
                                                x-show="
                                                    guests.length > 1 &&
                                                    ['room-available', 'room-reserved'].includes(mode)
                                                "
                                                @click.prevent="
                                                    guests.splice(element_index, 1);
                                                    hasUnsavedData = true;
                                                "
                                                title="Remover hóspede">
                                                    <img src="assets/icons/close.png" alt="X" >
                                                </button>
                                            </div>

                                            <div x-show="mode === 'room-occupied'"
                                                x-init="
                                                    const room = (await getRoom(roomData.number));
                                                    if (room.guests[index])
                                                        $refs.cpfDisplay.innerText = formatStrCPF(room.guests[index].cpf);
                                                ">
                                                <div>
                                                    <label class="
                                                        relative top-5 left-2 bg-background-bit-more-lighter p-1 px-2 rounded-t-xl
                                                        text-md text-label z-10
                                                    ">Nome</label>
                                                    <p class="font-bold text-xl mt-2 w-full p-4 rounded-full border-2 border-background-lightest"
                                                    x-text="guest.name"></p>
                                                </div>

                                                <div>
                                                    <label class="
                                                        relative top-5 left-2 bg-background-bit-more-lighter p-1 px-2 rounded-t-xl
                                                        text-md text-label z-10
                                                    ">CPF</label>
                                                    <p class="font-bold text-xl mt-2 w-full p-4 rounded-full border-2 border-background-lightest"
                                                    x-ref="cpfDisplay"></p>
                                                </div>

                                                <div>
                                                    <label class="
                                                        relative top-5 left-2 bg-background-bit-more-lighter p-1 px-2 rounded-t-xl
                                                        text-md text-label z-10
                                                    ">Telefone</label>
                                                    <p class="font-bold text-xl mt-2 w-full p-4 rounded-full border-2 border-background-lightest"
                                                    x-text="guest.phone"></p>
                                                </div>
                                            </div>

                                            <div x-show="mode !== 'room-occupied'">
                                                <div x-data="
                                                    {
                                                        focused: false,
                                                    }
                                                ">
                                                    <label class="
                                                        relative top-4 left-3 bg-background-lightest p-1 px-2 rounded-t-xl
                                                        text-md transition-[color] duration-300
                                                    "
                                                    :class="focused ? 'text-reserved' : 'text-label'">
                                                        Nome
                                                    </label>
                                                    <input class="
                                                        font-bold text-xl mt-2 w-full p-2 px-4 transition-[border] duration-300
                                                        outline-none border-2 bg-background-lightest rounded-full
                                                    "
                                                    :class="focused ? 'border-reserved' : 'border-background-lightest'"
                                                    type="text"
                                                    x-model="guest.name"
                                                    x-init="
                                                        guest.name = mode === 'room-available' ||
                                                        index >= roomData.guests.length
                                                            ? ''
                                                            : roomData.guests[index].name
                                                    "
                                                    @input="
                                                        hasUnsavedData = true;
                                                    "
                                                    @focus="focused = true"
                                                    @blur="focused = false"
                                                    :disabled="mode === 'room-occupied'">
                                                </div>
                                                
                                                <div x-data="
                                                    {
                                                        focused: false,
                                                    }
                                                ">
                                                    <label class="
                                                            relative top-4 left-3 bg-background-lightest p-1 px-2 rounded-t-xl
                                                            text-md transition-[color] duration-300
                                                        "
                                                        :class="focused ? 'text-reserved' : 'text-label'">CPF</label>
                                                    <input class="
                                                            font-bold text-xl mt-2 w-full p-2 px-4 transition-[border] duration-300
                                                            outline-none border-2 bg-background-lightest rounded-full
                                                        "
                                                        :class="focused ? 'border-reserved' : 'border-background-lightest'"
                                                        type="text" x-model="guest.cpf"
                                                        x-init="
                                                            guest.cpf = mode === 'room-available' ||
                                                            index >= roomData.guests.length
                                                                ? ''
                                                                : formatStrCPF(roomData.guests[index].cpf);
                                                        "
                                                        @input="e => {
                                                            formatCPF(e);
                                                            guest.cpf = e.target.value;
                                                            hasUnsavedData = true;
                                                        }
                                                        "
                                                        @focus="focused = true"
                                                        @blur="focused = false"
                                                        :disabled="mode === 'room-occupied'">
                                                </div>
                                                <div x-data="
                                                    {
                                                        focused: false,
                                                    }
                                                ">
                                                    <label class="
                                                            relative top-4 left-3 bg-background-lightest p-1 px-2 rounded-t-xl
                                                            text-md transition-[color] duration-300
                                                        "
                                                        :class="focused ? 'text-reserved' : 'text-label'">
                                                        Telefone
                                                    </label>
                                                    <input class="
                                                            font-bold text-xl mt-2 w-full p-2 px-4 transition-[border] duration-300
                                                            outline-none border-2 bg-background-lightest rounded-full
                                                        "
                                                        :class="focused ? 'border-reserved' : 'border-background-lightest'"
                                                        type="text"
                                                        x-model="guest.phone"
                                                        x-init="
                                                            guest.phone = mode === 'room-available' ||
                                                            index >= roomData.guests.length
                                                                ? ''
                                                                : formatStrPhone(roomData.guests[index].phone)
                                                        "
                                                        @input="e => {
                                                            formatPhone(e);
                                                            guest.phone = e.target.value;
                                                            hasUnsavedData = true;
                                                        }
                                                        "
                                                        @focus="focused = true"
                                                        @blur="focused = false"
                                                        :disabled="mode === 'room-occupied'">
                                                </div>
                                            </div>
                                        </div>
                                    </template>

                                    <button class="
                                            w-2/3 p-4 bg-background-bit-more-lighter rounded-full
                                            flex justify-center items-center hover:brightness-110
                                            transition-[background, brightness] duration-300
                                        "
                                        x-show="['room-available', 'room-reserved'].includes(mode)"
                                        @click.prevent="
                                            guests.push(
                                                {
                                                    name: '',
                                                    cpf: '',
                                                    phone: ''
                                                }
                                            );

                                            hasUnsavedData = true;
                                        ">
                                        <img class="w-5 mr-4" src="/assets/icons/plus.png" alt="">
                                        Adicionar hóspede
                                    </button>
                                </div>
                            </div>
                        </div>

                        <div x-show="hasUnsavedData && ['room-reserved', 'room-occupied'].includes(mode)" class="
                            w-full h-12 mb-4 p-2 flex justify-center
                            items-center rounded-full border-occupied border-2
                        "
                        x-transition>
                        <!-- TODO: don't change the flag if the input wasn't accepted -->
                            <img class="mr-3 w-7" src="assets/icons/warning.png" alt="Warning">
                            Você possui alterações não salvas.
                        </div>

                        <!-- Footer -->
                        <div class="
                            w-full h-14 flex items-center justify-evenly
                            rounded-full bg-background-more-lighter
                        ">
                            <!-- Botão Reservar - disponível no modo 'room-available' -->
                            <button x-show="mode === 'room-available'" class="
                                w-fit h-10 flex items-center justify-center p-2 pr-4 pl-4
                                rounded-full bg-background-lightest
                                hover:brightness-110 transition-[background, brightness] duration-300
                            "
                            @click.prevent="
                                const res = await reserve(roomData.number, guests, price, check_out);
                                if (res.success) {
                                    reset();
                                    hasUnsavedData = false;
                                }
                            ">
                                Reservar
                            </button>

                            <!-- --- -->

                            <!-- Botão Cancelar - disponível no modo 'room-reserved' -->
                            <button x-show="mode === 'room-reserved'" class="
                                w-fit h-10 flex items-center justify-center p-2 pr-4 pl-4
                                rounded-full bg-background-lightest
                                hover:brightness-110 transition-[background, brightness] duration-300
                            "
                            @click.prevent="
                                swal({
                                    title: 'Você tem certeza disso?',
                                    text: 'Você deseja cancelar a reserva?',
                                    icon: 'warning',
                                    buttons: true,
                                    dangerMode: 'true',
                                })
                                    .then(async (accepted) => {
                                        if (accepted) {
                                            const res = await cancel(roomData.number);
                                            if (res.success)
                                                reset();
                                        }
                                    });
                            ">
                                Cancelar Reserva
                            </button>

                            <!-- Botão Editar Reserva (Salvar Alterações 1) - disponível no modo 'room-reserved' -->
                            <button x-show="mode === 'room-reserved' && hasUnsavedData" class="
                                w-fit h-10 flex items-center justify-center p-2 pr-4 pl-4
                                rounded-full bg-background-lightest
                                hover:brightness-110 transition-[background, brightness] duration-300
                            "
                            @click.prevent="
                                const res = await editReservation(roomData.number, guests, price, check_out);
                                
                                if (res.success) {
                                    hasUnsavedData = false;
                                }
                            "
                            x-transition>
                                Salvar Alterações
                            </button>

                            <!-- Botão Check-In - disponível no modo 'room-reserved' -->
                            <button x-show="mode === 'room-reserved'" class="
                                w-fit h-10 flex items-center justify-center p-2 pr-4 pl-4
                                rounded-full bg-background-lightest
                                hover:brightness-110 transition-[background, brightness] duration-300
                            "
                            @click.prevent="
                                const res = await checkIn(roomData.number);
                                if(res.success)
                                    reset();
                            ">
                                Efetuar Check-In
                            </button>

                            <!-- --- -->

                            <!-- Botão Efetuar Pagamento - disponível no modo 'room-occupied' -->
                            <button x-show="mode === 'room-occupied'" class="
                                w-fit h-10 flex items-center justify-center p-2 pr-4 pl-4
                                rounded-full bg-background-lightest
                                hover:brightness-110 transition-[background, brightness] duration-300
                            "
                            @click.prevent="
                                visible = false;
                                setTimeout(() => {
                                    mode = 'payment'
                                    visible = true;
                                }, 350);
            
                                document.getElementById('reload-btn').click();
                            ">
                                Efetuar Pagamento
                            </button>

                            <!-- Botão Visualizar Pagamentos - disponível no modo 'room-occupied' -->
                            <button x-show="mode === 'room-occupied'" class="
                                w-fit h-10 flex items-center justify-center p-2 pr-4 pl-4
                                rounded-full bg-background-lightest
                                hover:brightness-110 transition-[background, brightness] duration-300
                            "
                            @click.prevent="
                                visible = false;
                                setTimeout(() => {
                                    mode = 'visualize-payments'
                                    visible = true;
                                }, 350);
            
                                document.getElementById('reload-btn').click();
                            ">
                                Visualizar Pagamentos
                            </button>

                            <!-- Botão Mudar Check-Out (Salvar Alterações 2) - disponível no modo 'room-reserved' -->
                            <button x-show="mode === 'room-occupied' && hasUnsavedData" class="
                                w-fit h-10 flex items-center justify-center p-2 pr-4 pl-4
                                rounded-full bg-background-lightest
                                hover:brightness-110 transition-[background, brightness] duration-300
                            "
                            @click.prevent="
                                let checkOutRes = { success: true };
                                if (changedCheckOut)
                                    checkOutRes = await changeCheckOut(roomData.number, check_out);
                                
                                const priceRes = await changePrice(roomData.number, price);
                                
                                if ((changedCheckOut && checkOutRes.success) || priceRes.success) {
                                    debt = await getRoomDebt(roomData.number) * 100;
                                    roomData = await getRoom(roomData.number);
                                }
                                
                                if (checkOutRes.success && priceRes.success)
                                    hasUnsavedData = false;
                            "
                            x-transition>
                                Salvar Alterações
                            </button>

                            <!-- Botão Check-Out - disponível no modo 'room-occupied' -->
                            <button x-show="mode === 'room-occupied'" href class="
                                w-fit h-10 flex items-center justify-center p-2 pr-4 pl-4
                                rounded-full bg-background-lightest
                                hover:brightness-110 transition-[background, brightness] duration-300
                            "
                            @click.prevent="
                                if (debt < 0) {
                                    if (getRoleLevel(user.role) >= getRoleLevel('manager')) {
                                        swal({
                                            title: 'O quarto possui sobras na conta',
                                            text: 'Selecione um modo para que o check-out possa ser efetuado.',
                                            icon: 'warning',
                                            buttons: {
                                                reverse: {
                                                    text: 'Estornar sobras',
                                                    value: 'reverse',
                                                },
    
                                                keep: {
                                                    text: 'Deixar no caixa',
                                                    value: 'keep',
                                                }
                                            },
                                        })
                                        .then(async (value) => {
                                            if (!['reverse', 'keep'].includes(value)) return;
    
                                            const res = await checkOut(roomData.number, value);
    
                                            if (res.success)
                                                reset();
                                        });
                                    }
                                    else {
                                        swal({
                                            title: 'O quarto possui sobras na conta',
                                            text: 'As sobras serão deixadas no caixa.',
                                            buttons: true,
                                            icon: 'warning'
                                        })
                                        .then(async (accepted) => {
                                            if (accepted) {
                                                const res = await checkOut(roomData.number, 'keep');
    
                                                if (res.success)
                                                    reset();
                                            }
                                        });
                                    }
                                }
                                else {
                                    const res = await checkOut(roomData.number, 'none');

                                    if (res.success)
                                        reset();
                                }
                            ">
                                
                                Efetuar Check-Out
                            </button>
                        </div>
                    </div>
                </template>
            </div>
        </div>
    </body>
</html>
